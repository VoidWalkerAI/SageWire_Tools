<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voyd's Clip Console</title>
<style>
    /* --- THEME VARIABLES (White Label / System Adaptive) --- */
    :root {
        /* Default Light Mode (Professional/Clean) */
        --bg-color: #f5f7fa;
        --card-bg: #ffffff;
        --text-main: #2c3e50;
        --text-muted: #7f8c8d;
        --accent-primary: #2980b9; /* Professional Blue */
        --accent-hover: #3498db;
        --border-color: #dcdcdc;
        --shadow: 0 4px 6px rgba(0,0,0,0.1);
        --code-bg: #f8f9fa;
        --tag-bg: #e1f5fe;
        --tag-text: #0277bd;
        --input-bg: #ffffff;
    }

    /* Dark Mode Override (Void Style) */
    @media (prefers-color-scheme: dark) {
        :root {
            --bg-color: #0f0f23; /* Deep Void */
            --card-bg: #1a1a2e;
            --text-main: #ecf0f1;
            --text-muted: #bdc3c7;
            --accent-primary: #e74c3c; /* Void Red */
            --accent-hover: #c0392b;
            --border-color: #34495e;
            --shadow: 0 4px 15px rgba(0,0,0,0.5);
            --code-bg: #0c0e14;
            --tag-bg: #2c3e50;
            --tag-text: #e74c3c;
            --input-bg: #0c0e14;
        }
    }

    * { box-sizing: border-box; }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-main);
        margin: 0;
        padding: 0;
        line-height: 1.6;
        transition: background-color 0.3s, color 0.3s;
    }

    .container {
        width: 95%;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }

    /* --- HEADER --- */
    .header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--accent-primary);
    }
    .header h1 {
        margin: 0 0 10px 0;
        font-size: 2.5rem;
        letter-spacing: 1px;
        color: var(--text-main);
    }
    .header p {
        margin: 0;
        color: var(--text-muted);
        font-style: italic;
    }

    /* --- NAVIGATION --- */
    .nav-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .btn {
        background-color: var(--accent-primary);
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 1rem;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s, transform 0.1s;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    .btn:hover { background-color: var(--accent-hover); transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    
    .btn-secondary { background-color: var(--text-muted); }
    .btn-secondary:hover { background-color: #95a5a6; }
    
    .btn-danger { background-color: #c0392b; }
    .btn-danger:hover { background-color: #e74c3c; }

    /* --- SECTIONS & CARDS --- */
    .section {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 25px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border-color);
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .hidden { display: none; }

    /* --- FORMS & INPUTS --- */
    .form-group { margin-bottom: 20px; }
    
    label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text-main);
    }

    .input-wrapper {
        position: relative;
        display: flex;
        gap: 10px;
    }

    .form-control {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background-color: var(--input-bg);
        color: var(--text-main);
        font-size: 1rem;
        font-family: inherit;
    }
    .form-control:focus { outline: 2px solid var(--accent-primary); border-color: transparent; }
    
    textarea.form-control {
        min-height: 150px;
        resize: vertical;
        font-family: 'Courier New', monospace; /* Monospace for code/notes */
    }

    /* --- VOICE BUTTON --- */
    .mic-btn {
        background-color: var(--card-bg);
        border: 1px solid var(--accent-primary);
        color: var(--accent-primary);
        border-radius: 6px;
        padding: 0 15px;
        cursor: pointer;
        font-size: 1.2rem;
        transition: all 0.2s;
    }
    .mic-btn:hover { background-color: var(--accent-primary); color: white; }
    .mic-btn.listening { background-color: #e74c3c; color: white; border-color: #e74c3c; animation: pulse 1.5s infinite; }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
        100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
    }

    /* --- CLIP ITEMS --- */
    .clip-item {
        border-bottom: 1px solid var(--border-color);
        padding: 20px 0;
    }
    .clip-item:last-child { border-bottom: none; }

    .clip-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 10px;
    }
    .clip-title { font-size: 1.25rem; font-weight: 700; color: var(--text-main); }
    .clip-date { font-size: 0.85rem; color: var(--text-muted); }

    .clip-content {
        background-color: var(--code-bg);
        padding: 15px;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        margin-bottom: 15px;
        border-left: 4px solid var(--accent-primary);
    }

    .clip-tags span {
        display: inline-block;
        background-color: var(--tag-bg);
        color: var(--tag-text);
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.85rem;
        margin-right: 5px;
        font-weight: 500;
    }

    .clip-actions {
        margin-top: 15px;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }
    .clip-actions .btn { padding: 6px 12px; font-size: 0.9rem; }

    /* --- SEARCH --- */
    .search-bar {
        margin-bottom: 25px;
        position: relative;
    }
    .search-clear {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: 1.2rem;
        cursor: pointer;
    }

    /* --- NOTIFICATIONS --- */
    #notification-area {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
    }
    .alert {
        padding: 15px 20px;
        background-color: var(--accent-primary);
        color: white;
        border-radius: 8px;
        margin-bottom: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        animation: slideInRight 0.3s ease;
    }
    @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    /* --- STATS --- */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        text-align: center;
    }
    .stat-card {
        background-color: var(--code-bg);
        padding: 15px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
    }
    .stat-num { display: block; font-size: 1.8rem; font-weight: bold; color: var(--accent-primary); }
    .stat-label { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; }

</style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>VOYD'S CLIP CONSOLE</h1>
        <p>Secure Local Storage ‚Ä¢ Voice-Enabled ‚Ä¢ System Adaptive</p>
    </div>

    <div id="notification-area"></div>

    <div class="nav-buttons">
        <button class="btn" onclick="showSection('view')" id="btn-view">üìÇ Library</button>
        <button class="btn" onclick="showSection('create')" id="btn-create">‚ûï New Clip</button>
        <button class="btn btn-secondary" onclick="showSection('stats')" id="btn-stats">üìä Stats</button>
        <button class="btn btn-secondary" onclick="exportData()">üíæ Backup</button>
    </div>

    <div id="view-section" class="section">
        <div class="search-bar">
            <input type="text" id="search-input" class="form-control" placeholder="Search clips, tags, or content..." onkeyup="filterClips()">
            <button class="search-clear hidden" id="search-clear" onclick="clearSearch()">‚úï</button>
        </div>
        <div id="clips-list">
            </div>
    </div>

    <div id="create-section" class="section hidden">
        <h2>Create New Clip</h2>
        <form onsubmit="saveClip(event)">
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="create-title" class="form-control" placeholder="Clip Title" required>
            </div>
            
            <div class="form-group">
                <label>Content</label>
                <div class="input-wrapper">
                    <textarea id="create-content" class="form-control" placeholder="Type or dictate your note here..." required></textarea>
                    <button type="button" class="mic-btn" onclick="toggleDictation('create-content')" title="Start Dictation">üéôÔ∏è</button>
                </div>
            </div>
            
            <div class="form-group">
                <label>Tags (comma separated)</label>
                <input type="text" id="create-tags" class="form-control" placeholder="work, idea, urgent">
            </div>
            
            <div style="display:flex; gap:10px;">
                <button type="submit" class="btn">Save Clip</button>
                <button type="button" class="btn btn-secondary" onclick="showSection('view')">Cancel</button>
            </div>
        </form>
    </div>

    <div id="edit-section" class="section hidden">
        <h2>Edit Clip</h2>
        <form onsubmit="updateClip(event)">
            <input type="hidden" id="edit-id">
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="edit-title" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Content</label>
                <div class="input-wrapper">
                    <textarea id="edit-content" class="form-control" required></textarea>
                    <button type="button" class="mic-btn" onclick="toggleDictation('edit-content')" title="Start Dictation">üéôÔ∏è</button>
                </div>
            </div>
            <div class="form-group">
                <label>Tags</label>
                <input type="text" id="edit-tags" class="form-control">
            </div>
            <div style="display:flex; gap:10px;">
                <button type="submit" class="btn">Update</button>
                <button type="button" class="btn btn-secondary" onclick="showSection('view')">Cancel</button>
            </div>
        </form>
    </div>

    <div id="stats-section" class="section hidden">
        <h2>Console Statistics</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-num" id="stat-total">0</span>
                <span class="stat-label">Total Clips</span>
            </div>
            <div class="stat-card">
                <span class="stat-num" id="stat-words">0</span>
                <span class="stat-label">Total Words</span>
            </div>
            <div class="stat-card">
                <span class="stat-num" id="stat-tags">0</span>
                <span class="stat-label">Tags Used</span>
            </div>
        </div>
    </div>

</div>

<script>
    // --- CONFIG ---
    const STORAGE_KEY = 'voydsClipConsole'; // Rebranded Storage Key
    let clips = [];
    let recognition = null;
    let isListening = false;

    // --- INIT ---
    document.addEventListener('DOMContentLoaded', () => {
        loadClips();
        renderClips();
        setupSpeechRecognition();
    });

    // --- DATA HANDLING ---
    function loadClips() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            clips = JSON.parse(saved);
        } else {
            // Migration check for old Black Ember data
            const oldData = localStorage.getItem('blackEmberClips');
            if (oldData) {
                clips = JSON.parse(oldData);
                saveData(); // Save to new key
                notify('Migrated data from Black Ember Console');
            }
        }
    }

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(clips));
        updateStats();
    }

    // --- NAVIGATION ---
    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
        document.getElementById(sectionId + '-section').classList.remove('hidden');
        
        // Stop dictation if switching views
        if (isListening) stopDictation();
        
        if (sectionId === 'view') renderClips();
        if (sectionId === 'stats') updateStats();
    }

    // --- CRUD OPERATIONS ---
    function saveClip(e) {
        e.preventDefault();
        const title = document.getElementById('create-title').value;
        const content = document.getElementById('create-content').value;
        const tagsStr = document.getElementById('create-tags').value;
        
        const newClip = {
            id: Date.now().toString(),
            title,
            content,
            tags: tagsStr.split(',').map(t => t.trim()).filter(t => t),
            created: new Date().toISOString(),
            modified: new Date().toISOString()
        };

        clips.unshift(newClip); // Add to top
        saveData();
        
        // Reset form
        document.getElementById('create-title').value = '';
        document.getElementById('create-content').value = '';
        document.getElementById('create-tags').value = '';
        
        notify('Clip Created');
        showSection('view');
    }

    function deleteClip(id) {
        if(confirm('Delete this clip permanently?')) {
            clips = clips.filter(c => c.id !== id);
            saveData();
            renderClips();
            notify('Clip Deleted');
        }
    }

    function editClip(id) {
        const clip = clips.find(c => c.id === id);
        if (!clip) return;

        document.getElementById('edit-id').value = clip.id;
        document.getElementById('edit-title').value = clip.title;
        document.getElementById('edit-content').value = clip.content;
        document.getElementById('edit-tags').value = clip.tags.join(', ');
        
        showSection('edit');
    }

    function updateClip(e) {
        e.preventDefault();
        const id = document.getElementById('edit-id').value;
        const index = clips.findIndex(c => c.id === id);
        
        if (index !== -1) {
            clips[index].title = document.getElementById('edit-title').value;
            clips[index].content = document.getElementById('edit-content').value;
            clips[index].tags = document.getElementById('edit-tags').value.split(',').map(t => t.trim()).filter(t => t);
            clips[index].modified = new Date().toISOString();
            
            saveData();
            notify('Clip Updated');
            showSection('view');
        }
    }

    // --- RENDERING ---
    function renderClips(filterText = '') {
        const list = document.getElementById('clips-list');
        list.innerHTML = '';
        
        const filtered = clips.filter(clip => {
            const searchStr = (clip.title + clip.content + clip.tags.join(' ')).toLowerCase();
            return searchStr.includes(filterText.toLowerCase());
        });

        if (filtered.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:var(--text-muted); padding:40px;">No clips found.</div>';
            return;
        }

        filtered.forEach(clip => {
            const date = new Date(clip.modified).toLocaleString();
            const tagsHtml = clip.tags.map(t => `<span>#${t}</span>`).join('');
            
            const el = document.createElement('div');
            el.className = 'clip-item';
            el.innerHTML = `
                <div class="clip-header">
                    <span class="clip-title">${clip.title}</span>
                    <span class="clip-date">${date}</span>
                </div>
                <div class="clip-content">${clip.content}</div>
                <div class="clip-tags">${tagsHtml}</div>
                <div class="clip-actions">
                    <button class="btn btn-secondary" onclick="editClip('${clip.id}')">Edit</button>
                    <button class="btn btn-danger" onclick="deleteClip('${clip.id}')">Delete</button>
                </div>
            `;
            list.appendChild(el);
        });
    }

    function filterClips() {
        const term = document.getElementById('search-input').value;
        document.getElementById('search-clear').classList.toggle('hidden', !term);
        renderClips(term);
    }

    function clearSearch() {
        document.getElementById('search-input').value = '';
        filterClips();
    }

    // --- SPEECH RECOGNITION ---
    function setupSpeechRecognition() {
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            
            recognition.onresult = (event) => {
                let interim = '';
                let final = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        final += event.results[i][0].transcript;
                    } else {
                        interim += event.results[i][0].transcript;
                    }
                }
                // Append to active text area
                if (activeTextArea) {
                    // Simple append logic (in reality you might handle cursor position)
                    const currentVal = activeTextArea.value;
                    // Note: This simple implementation might duplicate text if not careful with interim results.
                    // For robustness in simple app, we insert final only, or handle interim separately.
                    // Here we will just insert FINAL results to avoid complexity.
                    if (final) {
                        activeTextArea.value = currentVal + (currentVal ? ' ' : '') + final;
                    }
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech error', event);
                stopDictation();
                notify('Voice Error: ' + event.error);
            };
            
            recognition.onend = () => {
                stopDictation();
            };
        }
    }

    let activeTextArea = null;
    let activeMicBtn = null;

    function toggleDictation(textAreaId) {
        if (!recognition) {
            notify('Speech recognition not supported in this browser.');
            return;
        }

        const textArea = document.getElementById(textAreaId);
        const btn = textArea.nextElementSibling; // The mic button

        if (isListening) {
            stopDictation();
        } else {
            activeTextArea = textArea;
            activeMicBtn = btn;
            recognition.start();
            isListening = true;
            btn.classList.add('listening');
        }
    }

    function stopDictation() {
        if (recognition && isListening) {
            recognition.stop();
        }
        isListening = false;
        if (activeMicBtn) {
            activeMicBtn.classList.remove('listening');
            activeMicBtn = null;
        }
        activeTextArea = null;
    }

    // --- UTILS ---
    function updateStats() {
        document.getElementById('stat-total').textContent = clips.length;
        const wordCount = clips.reduce((acc, clip) => acc + clip.content.split(/\s+/).length, 0);
        document.getElementById('stat-words').textContent = wordCount;
        const allTags = new Set(clips.flatMap(c => c.tags));
        document.getElementById('stat-tags').textContent = allTags.size;
    }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(clips, null, 2));
        const link = document.createElement('a');
        link.setAttribute("href", dataStr);
        link.setAttribute("download", "voyds_clips_backup.json");
        document.body.appendChild(link);
        link.click();
        link.remove();
    }

    function notify(msg) {
        const area = document.getElementById('notification-area');
        const div = document.createElement('div');
        div.className = 'alert';
        div.textContent = msg;
        area.appendChild(div);
        setTimeout(() => div.remove(), 3000);
    }
</script>
</body>
</html>
